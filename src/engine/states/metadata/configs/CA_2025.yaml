# California State Tax Configuration for 2025
# Example of complex progressive tax structure with multiple brackets and credits

metadata:
  stateCode: CA
  stateName: California
  taxYear: 2025
  version: "1.0.0"
  lastUpdated: "2025-01-15"
  sources:
    - "California Franchise Tax Board"
    - "https://www.ftb.ca.gov/"
    - "Form 540 California Resident Income Tax Return"
    - "Publication 1001: Supplemental Guidelines to California Adjustments"
  notes:
    - "California has one of the highest state income tax rates (up to 13.3%)"
    - "Includes Mental Health Services Tax (1%) on income over $1 million"
    - "CalEITC and Young Child Tax Credit available for low-income families"

# Tax Structure: Progressive with 10 brackets
structure: progressive

# Tax Brackets by Filing Status
brackets:
  inflationIndexed: true
  topRate: 0.133  # 13.3% (includes 1% MHST)

  byFilingStatus:
    single:
      - min: 0
        max: 10412
        rate: 0.01
        description: "1% bracket"
      - min: 10412
        max: 24684
        rate: 0.02
        description: "2% bracket"
      - min: 24684
        max: 38959
        rate: 0.04
        description: "4% bracket"
      - min: 38959
        max: 54081
        rate: 0.06
        description: "6% bracket"
      - min: 54081
        max: 68350
        rate: 0.08
        description: "8% bracket"
      - min: 68350
        max: 349137
        rate: 0.093
        description: "9.3% bracket"
      - min: 349137
        max: 418961
        rate: 0.103
        description: "10.3% bracket"
      - min: 418961
        max: 698271
        rate: 0.113
        description: "11.3% bracket"
      - min: 698271
        max: 1000000
        rate: 0.123
        description: "12.3% bracket"
      - min: 1000000
        max: .inf
        rate: 0.133
        description: "13.3% bracket (12.3% + 1% MHST)"

    marriedJointly:
      - min: 0
        max: 20824
        rate: 0.01
      - min: 20824
        max: 49368
        rate: 0.02
      - min: 49368
        max: 77918
        rate: 0.04
      - min: 77918
        max: 108162
        rate: 0.06
      - min: 108162
        max: 136700
        rate: 0.08
      - min: 136700
        max: 698274
        rate: 0.093
      - min: 698274
        max: 837922
        rate: 0.103
      - min: 837922
        max: 1396542
        rate: 0.113
      - min: 1396542
        max: 1000000
        rate: 0.123
      - min: 1000000
        max: .inf
        rate: 0.133

    marriedSeparately:
      - min: 0
        max: 10412
        rate: 0.01
      - min: 10412
        max: 24684
        rate: 0.02
      - min: 24684
        max: 38959
        rate: 0.04
      - min: 38959
        max: 54081
        rate: 0.06
      - min: 54081
        max: 68350
        rate: 0.08
      - min: 68350
        max: 349137
        rate: 0.093
      - min: 349137
        max: 418961
        rate: 0.103
      - min: 418961
        max: 698271
        rate: 0.113
      - min: 698271
        max: 500000
        rate: 0.123
      - min: 500000
        max: .inf
        rate: 0.133

    headOfHousehold:
      - min: 0
        max: 20839
        rate: 0.01
      - min: 20839
        max: 49371
        rate: 0.02
      - min: 49371
        max: 63644
        rate: 0.04
      - min: 63644
        max: 78765
        rate: 0.06
      - min: 78765
        max: 93037
        rate: 0.08
      - min: 93037
        max: 474824
        rate: 0.093
      - min: 474824
        max: 569790
        rate: 0.103
      - min: 569790
        max: 949649
        rate: 0.113
      - min: 949649
        max: 1000000
        rate: 0.123
      - min: 1000000
        max: .inf
        rate: 0.133

# Standard Deduction
standardDeduction:
  available: true
  amounts:
    single: 5363
    marriedJointly: 10726
    marriedSeparately: 5363
    headOfHousehold: 10726
  # California does NOT have additional deductions for age/blindness

# Personal Exemptions
personalExemption:
  available: false  # Eliminated in 2018, replaced with credits
  amount: 0
  taxpayer: false
  spouse: false
  dependents: false

# Itemized Deductions
itemizedDeductions:
  allowed: true
  requiresFederalItemization: false  # CA allows itemizing even if federal standard deduction used

  deductions:
    salt:
      allowed: true
      # CA has no limit (unlike federal $10k cap)

    mortgageInterest:
      allowed: true
      # Generally follows federal rules

    charitable:
      allowed: true
      agiLimitPercentage: 50  # Varies by charity type

    medical:
      allowed: true
      agiThresholdPercentage: 7.5  # Must exceed 7.5% of AGI (aligns with federal)

    other:
      allowed: true
      categories:
        - "Casualty and theft losses"
        - "Miscellaneous deductions (differs from federal)"

# AGI Modifications
agiModifications:
  subtractions:
    # Railroad Retirement Benefits
    - id: railroad_retirement
      name: Railroad Retirement Benefits
      description: "Railroad Retirement Act benefits exempt from CA tax"
      category: retirement
      requiresInput: true
      inputField: railroadRetirement
      fullExemption: true

    # Lottery Winnings (from CA Lottery only)
    - id: ca_lottery
      name: California Lottery Winnings
      description: "Winnings from California State Lottery are exempt"
      category: other
      requiresInput: true
      inputField: caLotteryWinnings
      fullExemption: true

  additions:
    # State Income Tax Refund
    - id: state_tax_refund
      name: State Income Tax Refund
      description: "State/local tax refunds if deducted federally"
      category: deduction
      requiresInput: true
      inputField: stateLocalTaxRefund
      fullExemption: true

# Credits
credits:
  # California Earned Income Tax Credit (CalEITC)
  - id: caleitc
    name: California Earned Income Tax Credit (CalEITC)
    description: "State EITC for low-income working families"
    type: refundable
    category: earnedIncome
    calculation:
      method: table
      lookupKey: earnedIncome
      table:
        # Simplified - actual calculation more complex
        entries:
          - min: 1
            max: 11750
            credit: 3529
            multiplier: 1.0
    eligibility:
      - type: income
        operator: lte
        value: 31950  # AGI limit varies by # of children
      - type: income
        operator: gte
        value: 1  # Minimum earned income $1
    forms:
      - "FTB 3514"
      - "Form 540 Line 72"

  # Young Child Tax Credit (YCTC)
  - id: yctc
    name: Young Child Tax Credit (YCTC)
    description: "Credit for families with children under age 6"
    type: refundable
    category: child
    calculation:
      method: fixed
      amount: 1083  # Per child under 6
    eligibility:
      - type: age
        operator: lt
        value: 6
        description: "Child must be under 6 years old"
      - type: federalCreditClaimed
        operator: eq
        value: "caleitc"
        description: "Must qualify for CalEITC"
    maxCredit: 1083
    forms:
      - "FTB 3514"

  # Dependent Exemption Credit
  - id: dependent_credit
    name: Dependent Exemption Credit
    description: "Credit for each dependent"
    type: nonRefundable
    category: dependent
    calculation:
      method: tiered
      tiers:
        - threshold: 0
          value: 466
          valueType: amount
        - threshold: 250000  # Phase-out begins
          value: 233
          valueType: amount
        - threshold: 500000  # Fully phased out
          value: 0
          valueType: amount
    phaseOut:
      startThreshold:
        single: 250000
        marriedJointly: 500000
        marriedSeparately: 250000
        headOfHousehold: 375000
      endThreshold:
        single: 500000
        marriedJointly: 1000000
        marriedSeparately: 500000
        headOfHousehold: 750000
      rate: 0.06  # 6% per $2,500 of AGI over threshold

  # Renter's Credit
  - id: renters_credit
    name: California Renter's Credit
    description: "Credit for qualified renters"
    type: refundable
    category: property
    calculation:
      method: fixed
      amount: 120  # Single/HOH: $60, MFJ: $120
    eligibility:
      - type: income
        operator: lte
        value: 51041  # Single
      - type: custom
        operator: eq
        value: "renter"
        description: "Must be renting primary residence in California"
    maxCredit: 120
    forms:
      - "Form 540 Line 44"

  # Nonrefundable Renter's Credit (for higher income)
  - id: renters_credit_nonrefundable
    name: Nonrefundable Renter's Credit
    description: "Nonrefundable renter's credit for higher-income renters"
    type: nonRefundable
    category: property
    calculation:
      method: fixed
      amount: 120
    eligibility:
      - type: income
        operator: gt
        value: 51041
      - type: income
        operator: lte
        value: 102082  # Double the refundable limit
    maxCredit: 120

# Local Tax
localTax:
  hasLocalTax: false
  # California does NOT have local income taxes (unlike NY or PA)

# Special Taxes
specialTaxes:
  # Mental Health Services Tax (MHST)
  - id: mental_health_services_tax
    name: Mental Health Services Tax
    description: "Additional 1% tax on taxable income over $1 million"
    type: mentalHealth
    rate: 0.01  # 1%
    threshold:
      single: 1000000
      marriedJointly: 1000000
      marriedSeparately: 500000
      headOfHousehold: 1000000
    base: taxableIncome
    forms:
      - "Form 540 Line 31"

# Documentation
documentation:
  primaryForm: Form 540
  additionalForms:
    - "Schedule CA (540)" # California Adjustments
    - "Schedule D-1" # Sales of Business Property
    - "Schedule P" # Alternative Minimum Tax
    - "FTB 3514" # California Earned Income Tax Credit
    - "FTB 3519" # Payment for Automatic Extension

  authorityUrl: "https://www.ftb.ca.gov/"

  formUrls:
    Form 540: "https://www.ftb.ca.gov/forms/2025/2025-540.pdf"
    Schedule CA: "https://www.ftb.ca.gov/forms/2025/2025-540-ca.pdf"

  calculationNotes:
    - "California uses federal AGI as starting point with state-specific modifications"
    - "Standard deduction indexed for inflation annually"
    - "Mental Health Services Tax (1%) applies to taxable income over $1 million"
    - "CalEITC more generous than federal EITC for some income ranges"
    - "No local income taxes in California (unlike many other states)"
    - "California does not conform to all federal tax changes"

  scenarios:
    - name: "Middle Income Family"
      description: "Family with two children, standard deduction"
      exampleInputs:
        federalAGI: 85000
        filingStatus: marriedJointly
        dependents: 2
      expectedOutputs:
        caAGI: 85000
        standardDeduction: 10726
        taxableIncome: 74274
        stateTax: 4450  # Approximate
        credits: 932  # Dependent credits

    - name: "High Earner with MHST"
      description: "Single filer over $1M threshold"
      exampleInputs:
        federalAGI: 1500000
        filingStatus: single
      expectedOutputs:
        caAGI: 1500000
        standardDeduction: 5363
        taxableIncome: 1494637
        baseTax: 168975
        mentalHealthTax: 4946  # 1% on amount over $1M
        totalTax: 173921

    - name: "Low Income with CalEITC"
      description: "Single parent with one child, qualifies for CalEITC"
      exampleInputs:
        federalAGI: 25000
        earnedIncome: 25000
        filingStatus: headOfHousehold
        qualifyingChildren: 1
      expectedOutputs:
        caAGI: 25000
        standardDeduction: 10726
        taxableIncome: 14274
        stateTax: 285  # Before credits
        caleitc: 3529  # Refundable
        netTax: -3244  # Refund
