# ä»£ç æ”¹è¿›æŠ¥å‘Š

**æ—¥æœŸ**: 2025-09-30
**é¡¹ç›®**: USA Tax Calculator 2025

## ğŸ“Š æ”¹è¿›æˆæœæ€»ç»“

### æµ‹è¯•é€šè¿‡ç‡æå‡
- **æ”¹è¿›å‰**: 69/84 æµ‹è¯•é€šè¿‡ (82%)
- **æ”¹è¿›å**: 74/84 æµ‹è¯•é€šè¿‡ (88%)
- **æå‡**: +6% æµ‹è¯•é€šè¿‡ç‡

### å®Œæˆçš„æ”¹è¿›

#### âœ… 1. å¯ç”¨ TypeScript Strict Mode
**æ–‡ä»¶**: `tsconfig.json`

**å˜æ›´**:
```typescript
{
  "strict": true,                    // æ–°å¢
  "noUncheckedIndexedAccess": true,  // æ–°å¢
  "noImplicitReturns": true          // æ–°å¢
}
```

**å½±å“**:
- æå‡ç±»å‹å®‰å…¨æ€§
- åœ¨ç¼–è¯‘æ—¶æ•è·æ›´å¤šæ½œåœ¨é”™è¯¯
- ä¿®å¤äº† `advancedCredits.ts` ä¸­çš„ç±»å‹é”™è¯¯

---

#### âœ… 2. æ›´æ–° 2025 å¹´ IRS æ ‡å‡†æ•°æ®
**æ–‡ä»¶**: `src/engine/rules/2025/federal/deductions.ts`

**å˜æ›´**:
| é¡¹ç›® | æ—§å€¼ | æ–°å€¼ | ä¾æ® |
|------|------|------|------|
| å•èº«æ ‡å‡†æ‰£é™¤ | $15,000 | $15,750 | Rev. Proc. 2024-40 |
| å·²å©šè”åˆæ ‡å‡†æ‰£é™¤ | $30,000 | $31,500 | Rev. Proc. 2024-40 |
| æˆ·ä¸»æ ‡å‡†æ‰£é™¤ | $22,500 | $23,650 | Rev. Proc. 2024-40 |
| é¢å¤–æ‰£é™¤(65+/ç›²äºº) | $1,400 | $2,000 | IRS 2025æ›´æ–° |

**å½±å“**:
- ä¿®æ­£äº† 3 ä¸ªç›¸å…³æµ‹è¯•
- ç¡®ä¿è®¡ç®—ç¬¦åˆæœ€æ–° IRS è§„å®š

---

#### âœ… 3. ä¿®å¤è´§å¸è½¬æ¢é‡å¤é—®é¢˜
**æ–‡ä»¶**: `src/engine/federal/2025/advancedCredits.ts`

**é—®é¢˜**: LLC å’Œ AOTC è®¡ç®—ä¸­å­˜åœ¨ `convertToCents()` å‡½æ•°ï¼Œå¯¼è‡´åŒé‡è½¬æ¢
- è¾“å…¥: $6,000 â†’ 600,000 cents (æµ‹è¯•ä¸­)
- å‡½æ•°å†æ¬¡è½¬æ¢: Ã— 100 â†’ 60,000,000 cents

**ä¿®å¤**: ç§»é™¤ä¸å¿…è¦çš„ `convertToCents()` å‡½æ•°è°ƒç”¨

**å½±å“**:
- ä¿®å¤äº† LLC è®¡ç®—æµ‹è¯•
- ç¡®ä¿æ•™è‚²ç¨æ”¶æŠµå…å‡†ç¡®

---

#### âœ… 4. ä¿®å¤å¹´é¾„è®¡ç®—é€»è¾‘
**æ–‡ä»¶**: `src/engine/federal/2025/computeFederal2025.ts`

**é—®é¢˜**:
```typescript
// é”™è¯¯: åªè¦æœ‰å‡ºç”Ÿæ—¥æœŸå°±æ·»åŠ é¢å¤–æ‰£é™¤
if (input.primary.birthDate) {
  standardDeduction += ADDITIONAL_STANDARD_DEDUCTION_2025.age65OrOlder;
}
```

**ä¿®å¤**:
```typescript
// æ­£ç¡®: è®¡ç®—å¹´é¾„å¹¶æ£€æŸ¥æ˜¯å¦ >= 65
const calculateAge = (birthDate: string): number => {
  const parts = birthDate.split('-');
  const birthYear = parseInt(parts[0] || '0', 10);
  return TAX_YEAR - birthYear;
};

if (input.primary.birthDate && calculateAge(input.primary.birthDate) >= 65) {
  standardDeduction += ADDITIONAL_STANDARD_DEDUCTION_2025.age65OrOlder;
}
```

**å½±å“**:
- ä¿®å¤äº† 2 ä¸ªå®Œæ•´åœºæ™¯æµ‹è¯•
- ç¡®ä¿åªæœ‰ 65 å²ä»¥ä¸Šçº³ç¨äººè·å¾—é¢å¤–æ‰£é™¤

---

#### âœ… 5. ä¿®å¤è‡ªé›‡ç¨æµ‹è¯•
**æ–‡ä»¶**: `tests/golden/federal/2025/se-tax-calculation.spec.ts`

**é—®é¢˜**: æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨ $200,000 è‡ªé›‡æ”¶å…¥ï¼ŒæœŸæœ›è§¦å‘é¢å¤– Medicare ç¨
- å‡€è‡ªé›‡æ”¶å…¥: $200,000 Ã— 92.35% = $184,700
- é˜ˆå€¼: $200,000 (å•èº«)
- ç»“æœ: $184,700 < $200,000ï¼Œä¸è§¦å‘

**ä¿®å¤**: å°†æµ‹è¯•æ”¶å…¥è°ƒæ•´ä¸º $220,000
- å‡€è‡ªé›‡æ”¶å…¥: $220,000 Ã— 92.35% = $203,170
- $203,170 > $200,000ï¼Œè§¦å‘é¢å¤– Medicare ç¨ âœ“

**å½±å“**:
- æ‰€æœ‰ 9 ä¸ªè‡ªé›‡ç¨æµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## âš ï¸ å‰©ä½™é—®é¢˜ (10ä¸ªå¤±è´¥æµ‹è¯•)

### 1. EITC å¹´é¾„é™åˆ¶é—®é¢˜ (1ä¸ªå¤±è´¥)
**æµ‹è¯•**: `should exclude EITC for taxpayers outside age range (no children)`
- **é—®é¢˜**: æœªæ­£ç¡®å®æ–½æ— å­å¥³çº³ç¨äººçš„å¹´é¾„é™åˆ¶ï¼ˆ25-64å²ï¼‰
- **å»ºè®®**: åœ¨ `computeEITC2025` ä¸­æ·»åŠ å¹´é¾„éªŒè¯

### 2. é©¬é‡Œå…°å·ç¨è®¡ç®—é—®é¢˜ (4ä¸ªå¤±è´¥)
- å·²å©šå¤«å¦‡è®¡ç®—
- è´«å›°çº¿è±å…
- SALT æ‰£é™¤å¤„ç†
- è”é‚¦/å·é›†æˆ

**æ ¹æœ¬åŸå› **: å¯èƒ½æ˜¯è´§å¸è½¬æ¢æˆ–çŠ¶æ€å¼•æ“å®ç°é—®é¢˜

### 3. å®Œæ•´åœºæ™¯è®¡ç®—åå·® (5ä¸ªå¤±è´¥)
- é«˜æ”¶å…¥å¤«å¦‡ç›¸ä½
- å•äº² EITC
- è‡ªé›‡åœºæ™¯
- è€å¹´äººåœºæ™¯
- è´Ÿæ”¶å…¥å¤„ç†

**æ ¹æœ¬åŸå› **: å¤æ‚åœºæ™¯ä¸­çš„è¾“å…¥æ•°æ®æ ¼å¼æ··ä¹±ï¼ˆç¾å…ƒ vs ç¾åˆ†ï¼‰

---

## ğŸ¯ å»ºè®®çš„ä¸‹ä¸€æ­¥æ”¹è¿›

### é«˜ä¼˜å…ˆçº§

1. **ç»Ÿä¸€è´§å¸æ ¼å¼çº¦å®š**
   - åœ¨æ•´ä¸ªä»£ç åº“ä¸­æ ‡å‡†åŒ–ä¸ºç¾åˆ†
   - æ›´æ–°æ‰€æœ‰æµ‹è¯•ä»¥ä½¿ç”¨ä¸€è‡´çš„æ ¼å¼
   - æ·»åŠ æ¸…æ™°çš„æ–‡æ¡£è¯´æ˜

2. **å®æ–½ EITC å¹´é¾„éªŒè¯**
   ```typescript
   // åœ¨ computeEITC2025 ä¸­æ·»åŠ 
   if (qualifyingChildren === 0) {
     const age = calculateAge(input.primary.birthDate);
     if (age < 25 || age > 64) {
       return { eitc: 0, /* ... */ };
     }
   }
   ```

3. **ä¿®å¤é©¬é‡Œå…°å·ç¨å¼•æ“**
   - æ£€æŸ¥ `computeMD2025.ts` ä¸­çš„è®¡ç®—é€»è¾‘
   - éªŒè¯æœ¬åœ°ç¨ç‡åº”ç”¨
   - æµ‹è¯•è´«å›°çº¿è±å…å®æ–½

### ä¸­ä¼˜å…ˆçº§

4. **åºŸå¼ƒæ—§è®¡ç®—å¼•æ“**
   - ç§»é™¤ `src/utils/taxCalculations.js`
   - æ‰€æœ‰ç»„ä»¶è¿ç§»åˆ°æ–°çš„ç±»å‹åŒ–å¼•æ“
   - æ›´æ–° `engineAdapter.ts` ä»…ä½¿ç”¨æ–°å¼•æ“

5. **æ·»åŠ è¿è¡Œæ—¶æ•°æ®éªŒè¯**
   ```typescript
   import { z } from 'zod';

   const TaxInputSchema = z.object({
     filingStatus: z.enum(['single', 'marriedJointly', ...]),
     income: z.object({
       wages: z.number().nonnegative(),
       // ...
     })
   });
   ```

6. **é‡æ„ App.tsx**
   - æ‹†åˆ†ä¸ºæ¨¡å—: `SpouseDialog.tsx`, `AdvancedFeaturesModal.tsx`
   - æå–è‡ªå®šä¹‰ hooks
   - å‡å°‘ç»„ä»¶å¤æ‚åº¦

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | å˜åŒ– |
|------|--------|--------|------|
| æµ‹è¯•é€šè¿‡ | 69/84 | 74/84 | +5 |
| é€šè¿‡ç‡ | 82% | 88% | +6% |
| TypeScript ä¸¥æ ¼æ¨¡å¼ | âŒ | âœ… | å·²å¯ç”¨ |
| ç¼–è¯‘é”™è¯¯ | 3 | 0 | -3 |
| ä»£ç è´¨é‡ | ä¸­ç­‰ | è‰¯å¥½ | â†‘ |

---

## ğŸ” è¯¦ç»†å˜æ›´åˆ—è¡¨

### ä¿®æ”¹çš„æ–‡ä»¶

1. `tsconfig.json` - å¯ç”¨ strict mode
2. `src/engine/rules/2025/federal/deductions.ts` - æ›´æ–° IRS 2025 æ ‡å‡†
3. `src/engine/federal/2025/advancedCredits.ts` - ä¿®å¤è´§å¸è½¬æ¢
4. `src/engine/federal/2025/computeFederal2025.ts` - ä¿®å¤å¹´é¾„è®¡ç®—
5. `tests/golden/federal/2025/se-tax-calculation.spec.ts` - è°ƒæ•´æµ‹è¯•ç”¨ä¾‹
6. `tests/golden/federal/2025/irs-constants.spec.ts` - æ›´æ–°æœŸæœ›å€¼
7. `tests/golden/federal/2025/basic.spec.ts` - æ›´æ–°æœŸæœ›å€¼

### æ–°å¢åŠŸèƒ½

- å¹´é¾„è®¡ç®—è¾…åŠ©å‡½æ•°
- æ›´å‡†ç¡®çš„æ ‡å‡†æ‰£é™¤è®¡ç®—

---

## ğŸ’¡ æ¶æ„å»ºè®®

### å½“å‰æ¶æ„é—®é¢˜

1. **åŒé‡è®¡ç®—ç³»ç»Ÿ**
   - æ—§ç³»ç»Ÿ: JavaScript (`taxCalculations.js`)
   - æ–°ç³»ç»Ÿ: TypeScript (`computeFederal2025.ts`)
   - **é£é™©**: ä¸ä¸€è‡´ã€ç»´æŠ¤å›°éš¾

2. **è´§å¸æ ¼å¼æ··ä¹±**
   - UI å±‚ä½¿ç”¨ç¾å…ƒå­—ç¬¦ä¸²
   - å¼•æ“ä½¿ç”¨ç¾åˆ†æ•´æ•°
   - æµ‹è¯•æ··ç”¨ä¸¤è€…

3. **ç»„ä»¶è¿‡å¤§**
   - `App.tsx` 1335 è¡Œ
   - éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•

### æ¨èæ¶æ„

```
src/
â”œâ”€â”€ engine/              # æ ¸å¿ƒè®¡ç®—å¼•æ“ (TypeScript, çº¯å‡½æ•°)
â”‚   â”œâ”€â”€ federal/
â”‚   â”œâ”€â”€ states/
â”‚   â””â”€â”€ types.ts
â”œâ”€â”€ adapters/           # UI â†” å¼•æ“é€‚é…å±‚
â”‚   â””â”€â”€ taxAdapter.ts
â”œâ”€â”€ components/         # React ç»„ä»¶ (< 300 è¡Œ/æ–‡ä»¶)
â”‚   â”œâ”€â”€ forms/
â”‚   â”œâ”€â”€ modals/
â”‚   â””â”€â”€ widgets/
â””â”€â”€ hooks/             # è‡ªå®šä¹‰ React hooks
    â””â”€â”€ useTaxEngine.ts
```

---

## âœ… è´¨é‡æ£€æŸ¥æ¸…å•

- [x] TypeScript strict mode å¯ç”¨
- [x] ç¼–è¯‘æ— é”™è¯¯
- [x] 88% æµ‹è¯•é€šè¿‡
- [x] æ ¸å¿ƒ IRS å¸¸é‡å‡†ç¡®
- [x] è‡ªé›‡ç¨è®¡ç®—æ­£ç¡®
- [x] æ•™è‚²ç¨æ”¶æŠµå…ä¿®å¤
- [ ] å®Œå…¨ç»Ÿä¸€è´§å¸æ ¼å¼
- [ ] EITC å¹´é¾„éªŒè¯å®æ–½
- [ ] é©¬é‡Œå…°å·ç¨ä¿®å¤
- [ ] 100% æµ‹è¯•é€šè¿‡

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [IRS Rev. Proc. 2024-40](https://www.irs.gov/pub/irs-drop/rp-24-40.pdf) - 2025 å¹´é€šè´§è†¨èƒ€è°ƒæ•´
- [IRS Form 1040 Instructions](https://www.irs.gov/forms-pubs/about-form-1040) - è”é‚¦ç¨åŠ¡è¡¨æ ¼
- [Schedule SE Instructions](https://www.irs.gov/forms-pubs/about-schedule-se-form-1040) - è‡ªé›‡ç¨
- [TypeScript Strict Mode](https://www.typescriptlang.org/tsconfig#strict) - é…ç½®æ–‡æ¡£

---

**æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨åŒ–ä»£ç å®¡æŸ¥å’Œæ”¹è¿›è¿‡ç¨‹
**ä¸‹æ¬¡å®¡æŸ¥**: å»ºè®® 2 å‘¨åå¤å®¡å‰©ä½™é—®é¢˜